---
ms.openlocfilehash: 3e62289181d994a0e786bb53417f576ac1a3059b
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052493"
---
# <a name="azure-cosmos-db-client-library-for-javascripttypescript"></a>Biblioteca cliente de Azure Cosmos DB para JavaScript/TypeScript

[![Estado de compilación](https://img.shields.io/npm/v/%40azure%2Fcosmos/latest.svg)][npm]
[![último distintivo de npm](https://dev.azure.com/azure-sdk/public/_apis/build/status/js/js%20-%20cosmosdb%20-%20ci?branchName=main)](https://dev.azure.com/azure-sdk/public/_build/latest?definitionId=850&branchName=main)

Azure Cosmos DB es un servicio de base de datos multimodelo distribuido globalmente que admite bases de datos de documentos, pares clave-valor, basadas en columnas y gráficos. Este paquete está diseñado para que las aplicaciones JavaScript/Typescript interactúen con bases de datos de **SQL API** y los documentos JSON que contienen:

- Creación de bases de datos de Cosmos DB y modificación de su configuración
- Crear y modificar contenedores para almacenar colecciones de documentos JSON
- Crear, leer, actualizar y eliminar los elementos (documentos JSON) en los contenedores
- Consultar los documentos de la base de datos mediante la sintaxis similar a SQL

Vínculos principales:

- [Paquete (npm)][npm]
- [Documentación de referencia de API](https://docs.microsoft.com/javascript/api/@azure/cosmos/?view=azure-node-lates)
- [Documentación del producto][cosmos_docs]

## <a name="getting-started"></a>Introducción

### <a name="prerequisites"></a>Requisitos previos

#### <a name="azure-subscription-and-cosmos-db-sql-api-account"></a>Suscripción de Azure y cuenta de SQL API de Cosmos DB

Debe tener una [suscripción de Azure][azure_sub] y una [cuenta de Cosmos DB][cosmos_account] (SQL API) para usar este paquete.

Si necesita una cuenta de SQL API de Cosmos DB, puede usar Azure [Cloud Shell][cloud_shell_bash] para crear una con este comando de la CLI de Azure:

```Bash
az cosmosdb create --resource-group <resource-group-name> --name <cosmos-database-account-name>
```

O puede crear una cuenta en [Azure Portal](https://portal.azure.com/#create/microsoft.documentdb)

#### <a name="nodejs"></a>NodeJS

Este paquete se distribuye a través de [npm][npm], que viene preinstalado con [NodeJS](https://nodejs.org/en/). Debe usar Node v10 o superior.

#### <a name="cors"></a>CORS

Debe configurar reglas de [uso compartido de recursos entre orígenes (CORS)](https://docs.microsoft.com/azure/cosmos-db/how-to-configure-cross-origin-resource-sharing) para la cuenta de Cosmos DB si necesita desarrollar para exploradores. Siga las instrucciones del documento vinculado para crear nuevas reglas de CORS para Cosmos DB.

### <a name="install-this-package"></a>Instalación de este paquete

```Bash
npm install @azure/cosmos
```

### <a name="get-account-credentials"></a>Obtención de credenciales de la cuenta

Necesitará el **punto de conexión** y la **clave de la cuenta** de Cosmos DB. Puede encontrarlos en [Azure Portal](https://portal.azure.com/#blade/hubsextension/browseresource/resourcetype/microsoft.documentdb%2fdatabaseaccounts) o usar el fragmento de código de la [CLI de Azure][azure_cli] siguiente. El fragmento de código tiene el formato para el shell de Bash.

```Bash
az cosmosdb show --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
az cosmosdb keys list --resource-group <your-resource-group> --name <your-account-name> --query documentEndpoint --output tsv
```

### <a name="create-an-instance-of-cosmosclient"></a>Creación de una instancia de `CosmosClient`

La interacción con Cosmos DB comienza con una instancia de la clase [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest)

```js
const { CosmosClient } = require("@azure/cosmos");

const endpoint = "https://your-account.documents.azure.com";
const key = "<database account masterkey>";
const client = new CosmosClient({ endpoint, key });

async function main() {
  // The rest of the README samples are designed to be pasted into this function body
}

main().catch((error) => {
  console.error(error);
});
```

Por motivos de simplicidad, hemos incluido `key` y `endpoint` directamente en el código, pero es probable que quiera cargarlos desde un archivo que no esté en el control de código fuente mediante un proyecto como [dotenv](https://www.npmjs.com/package/dotenv) o cargar desde variables de entorno

En entornos de producción, los secretos como las claves deben almacenarse en [Azure Key Vault](https://azure.microsoft.com/services/key-vault/)

## <a name="key-concepts"></a>Conceptos clave

Una vez que haya inicializado [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-lates), puede interactuar con los tipos de recursos principales de Cosmos DB:

- [Base de datos](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest): Una cuenta de Cosmos DB puede contener varias bases de datos. Al crear una base de datos, especifique la API que desea usar al interactuar con sus documentos: SQL, MongoDB, Gremlin, Cassandra, o Azure Table. Use el objeto [Database](https://docs.microsoft.com/javascript/api/@azure/cosmos/database?view=azure-node-latest) para administrar sus contenedores.

- [Contenedor](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest): Un contenedor es una colección de documentos JSON. Puede crear (insertar), leer, actualizar y eliminar elementos en un contenedor mediante métodos en el objeto [Contenedor](https://docs.microsoft.com/javascript/api/@azure/cosmos/container?view=azure-node-latest).

- [Elemento](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest): Un elemento es un documento JSON almacenado en un contenedor. Cada elemento debe incluir una clave `id` con un valor que identifique de forma única el elemento dentro del contenedor. Si no se proporciona un `id`, el SDK generará uno automáticamente.

Para más información sobre estos recursos, consulte [Uso de bases de datos, contenedores y elementos de Azure Cosmos][cosmos_resources].

## <a name="examples"></a>Ejemplos

Las secciones siguientes proporcionan varios fragmentos de código que abarcan algunas de las tareas más comunes de Cosmos DB, entre las que se incluyen las siguientes:

- [Creación de una base de datos](#create-a-database)
- [Creación de un contenedor](#create-a-container)
- [Inserción de elementos](#insert-items)
- [Consulta de documentos](#query-the-database)
- [Lectura de un elemento](#read-an-item)
- [Eliminación de un elemento](#delete-an-data)

### <a name="create-a-database"></a>Crear una base de datos

Después de autenticar [CosmosClient](https://docs.microsoft.com/javascript/api/@azure/cosmos/cosmosclient?view=azure-node-latest), puede trabajar con cualquier recurso de la cuenta. El fragmento de código siguiente crea una base de datos de SQL API.

```js
const { database } = await client.databases.createIfNotExists({ id: "Test Database" });
console.log(database.id);
```

### <a name="create-a-container"></a>Crear un contenedor

En este ejemplo se crea un contenedor con la configuración predeterminada

```js
const { container } = await database.containers.createIfNotExists({ id: "Test Database" });
console.log(container.id);
```

### <a name="insert-items"></a>Inserción de elementos

Para insertar elementos en un contenedor, pase un objeto que contenga los datos a [Items.upsert](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#upsert-t--requestoptions-). El servicio Cosmos DB requiere que cada elemento tenga una clave `id`. Si no se proporciona, el SDK generará una `id` automáticamente.

En este ejemplo se insertan varios elementos en el contenedor

```js
const cities = [
  { id: "1", name: "Olympia", state: "WA", isCapitol: true },
  { id: "2", name: "Redmond", state: "WA", isCapitol: false },
  { id: "3", name: "Chicago", state: "IL", isCapitol: false }
];
for (const city of cities) {
  container.items.create(city);
}
```

### <a name="read-an-item"></a>Lectura de un elemento

Para leer un solo elemento de un contenedor, use [Item.read](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#read-requestoptions-). Se trata de una operación menos costosa que el uso de SQL para consultar mediante `id`.

```js
await container.item("1").read();
```

### <a name="delete-an-item"></a>Eliminación de un elemento

Para eliminar elementos de un contenedor, use [Item.delete](https://docs.microsoft.com/javascript/api/@azure/cosmos/item?view=azure-node-latest#delete-requestoptions-).

```js
// Delete the first item returned by the query above
await container.item("1").delete();
```

### <a name="query-the-database"></a>Consulta de la base de datos

Una base de datos de SQL API de Cosmos DB admite la consulta de los elementos de un contenedor con [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-) mediante una sintaxis similar a SQL:

```js
const { resources } = await container.items
  .query("SELECT * from c WHERE c.isCapitol = true")
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Para realizar consultas con parámetros, pase un objeto que contenga los parámetros y sus valores a [Items.query](https://docs.microsoft.com/javascript/api/@azure/cosmos/items?view=azure-node-latest#query-string---sqlqueryspec--feedoptions-):

```js
const { resources } = await container.items
  .query({
    query: "SELECT * from c WHERE c.isCapitol = @isCapitol",
    parameters: [{ name: "@isCapitol", value: true }]
  })
  .fetchAll();
for (const city of resources) {
  console.log(`${city.name}, ${city.state} is a capitol `);
}
```

Para más información sobre cómo consultar bases de datos de Cosmos DB mediante SQL API, consulte [Consulta de datos de Azure Cosmos DB con consultas SQL][cosmos_sql_queries].

## <a name="troubleshooting"></a>Solución de problemas

### <a name="general"></a>General

Al interactuar con Cosmos DB, los errores devueltos por el servicio se corresponden con los mismos códigos de estado HTTP devueltos para las solicitudes de API de REST:

[Códigos de estado HTTP para Azure Cosmos DB][cosmos_http_status_codes]

#### <a name="conflicts"></a>Conflictos

Por ejemplo, si intenta crear un elemento mediante un `id` que ya está en uso en la base de datos de Cosmos DB, se devuelve un error `409`, lo que indica el conflicto. En el siguiente fragmento, el error se controla correctamente al detectar la excepción y mostrar información adicional sobre el error.

```js
try {
  await containers.items.create({ id: "existing-item-id" });
} catch (error) {
  if (error.code === 409) {
    console.log("There was a conflict with an existing item");
  }
}
```

### <a name="transpiling"></a>Transpilación

Los SDK de Azure están diseñados para admitir la sintaxis de JavaScript ES5 y las [versiones LTS de Node.js](https://nodejs.org/about/releases/). Si necesita compatibilidad con entornos de ejecución de JavaScript anteriores, como Internet Explorer o Node 6, deberá transpilar el código del SDK como parte del proceso de compilación.

### <a name="handle-transient-errors-with-retries"></a>Control de errores transitorios con reintentos

Al trabajar con Cosmos DB, puede encontrar errores transitorios producidos por [límites de frecuencia][cosmos_request_units] aplicados por el servicio u otros problemas transitorios, como interrupciones de red. Para información sobre cómo controlar estos tipos de errores, consulte la sección sobre el [patrón Retry][azure_pattern_retry] en la guía de patrones de diseño en la nube y el [patrón Circuit Breaker][azure_pattern_circuit_breaker] relacionado.

## <a name="next-steps"></a>Pasos siguientes

### <a name="more-sample-code"></a>Más código de ejemplo

Hay [varios ejemplos][cosmos_samples] en el repositorio de GitHub del SDK. Estos ejemplos proporcionan código de ejemplo de escenarios adicionales que suelen aparecer al trabajar con Cosmos DB:

- Operaciones de base de datos
- Operaciones de contenedor
- Operaciones de elemento
- Configuración de la indexación
- Lectura de una fuente de cambios de contenedor
- Procedimientos almacenados
- Cambio de la configuración de rendimiento de base de datos o contenedor
- Operaciones de escritura en varias regiones

### <a name="additional-documentation"></a>Documentación adicional

Para obtener documentación ampliada sobre el servicio Cosmos DB, consulte la [documentación de Azure Cosmos DB][cosmos_docs] en docs.microsoft.com.

## <a name="useful-links"></a>Vínculos útiles

- [Bienvenido a Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/community)
- [Inicio rápido](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-get-started)
- [Tutorial](https://docs.microsoft.com/azure/cosmos-db/sql-api-nodejs-application)
- [Muestras](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples)
- [Introducción al modelo de recursos del servicio Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-resources)
- [Introducción a SQL API del servicio Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/sql-api-sql-query)
- [Partitioning](https://docs.microsoft.com/azure/cosmos-db/sql-api-partition-data)
- [Documentación de la API](https://docs.microsoft.com/javascript/api/%40azure/cosmos/?view=azure-node-latest)

## <a name="contributing"></a>Contribuciones

Si desea contribuir a esta biblioteca, lea la [guía de contribución](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md) para obtener más información sobre cómo compilar y probar el código.

![Impresiones](https://azure-sdk-impressions.azurewebsites.net/api/impressions/azure-sdk-for-js%2Fsdk%2Fcosmosdb%2Fcosmos%2FREADME.png)

<!-- LINKS -->

[azure_cli]: https://docs.microsoft.com/cli/azure
[azure_pattern_circuit_breaker]: https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker
[azure_pattern_retry]: https://docs.microsoft.com/azure/architecture/patterns/retry
[azure_portal]: https://portal.azure.com
[azure_sub]: https://azure.microsoft.com/free/
[cloud_shell]: https://docs.microsoft.com/azure/cloud-shell/overview
[cloud_shell_bash]: https://shell.azure.com/bash
[cosmos_account_create]: https://docs.microsoft.com/azure/cosmos-db/how-to-manage-database-account
[cosmos_account]: https://docs.microsoft.com/azure/cosmos-db/account-overview
[cosmos_container]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-containers
[cosmos_database]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-databases
[cosmos_docs]: https://docs.microsoft.com/azure/cosmos-db/
[cosmos_http_status_codes]: https://docs.microsoft.com/rest/api/cosmos-db/http-status-codes-for-cosmosdb
[cosmos_item]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items#azure-cosmos-items
[cosmos_request_units]: https://docs.microsoft.com/azure/cosmos-db/request-units
[cosmos_resources]: https://docs.microsoft.com/azure/cosmos-db/databases-containers-items
[cosmos_samples]: https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/cosmosdb/cosmos/samples
[cosmos_sql_queries]: https://docs.microsoft.com/azure/cosmos-db/how-to-sql-query
[cosmos_ttl]: https://docs.microsoft.com/azure/cosmos-db/time-to-live
[npm]: https://www.npmjs.com/package/@azure/cosmos
