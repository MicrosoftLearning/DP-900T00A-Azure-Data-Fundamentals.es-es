---
ms.openlocfilehash: 4f36d4681facd228c63b48050973040e9785d30f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052181"
---

<a name="microsoft-authentication-library-for-javascript-msaljs"></a>Biblioteca de autenticación de Microsoft para JavaScript (MSAL.js)
=========================================================

| [Introducción](https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa)| [Documentos de AAD](https://aka.ms/aaddevv2) | [Referencia de la biblioteca](https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal.html) | [Soporte técnico](README.md#community-help-and-support) | [Muestras](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples)
| --- | --- | --- | --- | --- |

⚠️⚠️⚠️ Esta biblioteca ya no recibe nuevas características y solo recibirá correcciones críticas de errores y seguridad. Las aplicaciones nuevas deben usar [@azure/msal-browser](https://www.npmjs.com/package/@azure/msal-browser) en su lugar. ⚠️⚠️⚠️

MSAL para JavaScript permite a las aplicaciones web de JavaScript del lado del cliente que se ejecutan en un explorador web autenticar a los usuarios mediante cuentas profesionales y educativas de [Azure AD](https://docs.microsoft.com/azure/active-directory/develop/v2-overview) (AAD), cuentas personales de Microsoft (MSA) y proveedores de identidades sociales como Facebook, Google, LinkedIn, cuentas Microsoft, etc. a través del servicio [Azure AD B2C](https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers). También permite que la aplicación obtenga tokens para acceder a los servicios de [Microsoft Cloud](https://www.microsoft.com/enterprise), como [Microsoft Graph](https://graph.microsoft.io).

[![npm version](https://img.shields.io/npm/v/msal.svg?style=flat)](https://www.npmjs.com/package/msal)
[![npm version](https://img.shields.io/npm/dm/msal.svg)](https://nodei.co/npm/msal/)
[![codecov](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js/branch/dev/graph/badge.svg?flag=msal-core)](https://codecov.io/gh/AzureAD/microsoft-authentication-library-for-js)

## <a name="installation"></a>Instalación

### <a name="via-npm"></a>A través de NPM:

    npm install msal

## <a name="via-cdn"></a>A través de CDN:

<!-- CDN_LATEST -->
```html
<script type="text/javascript" src="https://alcdn.msauth.net/lib/1.4.11/js/msal.min.js"></script>
```

[En nuestra documentación encontrará detalles completos y procedimientos recomendados](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/docs/cdn.md) para el uso de la red CDN.

## <a name="what-to-expect-from-this-library"></a>Qué esperar de esta biblioteca
La compatibilidad con Msal en Javascript es una colección de bibliotecas. `msal-core` o simplemente `msal`, es la biblioteca principal independiente del marco. Una vez que nuestro núcleo 1.x+ está estabilizado, vamos a traer nuestra `msal-angular` biblioteca con las últimas mejoras de la versión 1.x.  Estamos planeando dejar de usar la compatibilidad para `msal-angularjs` en función de las tendencias de uso del marco y la biblioteca que indica una mayor adopción de Angular 2+ en lugar de Angular 1x. Después de que nuestras bibliotecas actuales estén al día de los estándares, comenzaremos a equilibrar las nuevas solicitudes de características, con nuevas plataformas como `react` y `node.js`.

Nuestro objetivo es comunicarnos muy bien con la comunidad y tener en cuenta sus opiniones. Nos gustaría llegar a una programación mensual de versiones secundarias, con revisiones que vienen con la frecuencia necesaria.  El nivel de comunicación, planificación y granularidad que queremos conseguir será un trabajo en curso.

Consulte nuestra [hoja de ruta](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki#roadmap) para ver en qué estamos trabajando y de qué estamos realizando el seguimiento.

## <a name="oauth-20-and-the-implicit-flow"></a>OAuth 2.0 y el flujo implícito

Msal implementa el [flujo de concesión implícita](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-implicit-grant-flow), tal y como se define en el protocolo OAuth 2.0 y es compatible con [OpenID](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc).

Nuestro objetivo es que la biblioteca se abstraiga lo suficiente del protocolo para que pueda obtener la autenticación plug and play, pero es importante conocer y comprender el flujo implícito desde una perspectiva de seguridad.
El flujo implícito se ejecuta en el contexto de un explorador web que no puede administrar los secretos de cliente de forma segura. Está optimizado para aplicaciones de página única y tiene un salto menos entre el cliente y el servidor, por lo que los tokens se devuelven directamente al explorador. Estos aspectos hacen que sea naturalmente menos seguro.
Estos problemas de seguridad se mitigan por procedimientos estándar, como el uso de tokens de corta duración (y, por lo tanto, no se devuelven tokens de actualización), por el hecho de que la biblioteca requiere un URI de redireccionamiento registrado para la aplicación, y por el hecho de que la biblioteca coincide con la solicitud y la respuesta con un parámetro de estado y nonce único.

## <a name="cache-storage"></a>Almacenamiento en caché

Ofrecemos dos métodos de almacenamiento para Msal `localStorage` y `sessionStorage`.  Se recomienda utilizar la opción `sessionStorage` porque es más segura para almacenar los tokens que adquieren sus usuarios, pero `localStorage` le proporcionará Inicio de sesión único entre pestañas y sesiones de usuario.  Le recomendamos que explore las opciones y tome la mejor decisión para su aplicación.

### <a name="forcerefresh-to-skip-cache"></a>forceRefresh para omitir la memoria caché
Si desea omitir un token almacenado en caché e ir al servidor, pase el valor booleano `forceRefresh` al objeto `AuthenticationParameters` usado para realizar una solicitud de token o inicio de sesión. **ADVERTENCIA:** No debe usarse de forma predeterminada, debido al impacto en el rendimiento de la aplicación.  Confiar en la memoria caché proporcionará a los usuarios una mejor experiencia y omitirla solo debe usarse en escenarios en los que sepa que los datos almacenados en caché actuales no tienen información actualizada.  Ejemplo: En el caso de una herramienta de administración que agrega roles a un usuario que necesita obtener un nuevo token con roles actualizados.

## <a name="usage"></a>Uso
En el ejemplo siguiente se explica cómo inicia sesión un usuario y adquiere un token que se usará para Graph Api de Microsoft.

#### <a name="prerequisites"></a>Prerrequisitos

Antes de usar MSAL.js deberá [registrar una aplicación en Azure AD](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app) para obtener un valor válido `clientId` para la configuración y registrar las rutas en las que la aplicación aceptará el tráfico de redireccionamiento.

#### <a name="1-instantiate-the-useragentapplication"></a>1. Crear una instancia de UserAgentApplication

`UserAgentApplication` se puede configurar con una variedad de opciones diferentes, detalladas en nuestra [Wiki](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#configuration-options), pero el único parámetro necesario es `auth.clientId`.

Después de crear una instancia de la instancia, si planea usar un flujo de redireccionamiento en MSAL 1.2.x o anterior (`loginRedirect` y `acquireTokenRedirect`), debe registrar un controlador de devolución de llamada mediante `handleRedirectCallback(authCallback)` donde `authCallback = function(AuthError, AuthResponse)`. A partir de MSAL 1.3.0, esto es opcional. Se llama a la función de devolución de llamada después de que la solicitud de autenticación se complete correctamente o con un error. Esto no es necesario para los flujos emergentes, ya que devuelven promesas.

```JavaScript
    import * as Msal from "msal";
    // if using cdn version, 'Msal' will be available in the global scope

    const msalConfig = {
        auth: {
            clientId: 'your_client_id'
        }
    };

    const msalInstance = new Msal.UserAgentApplication(msalConfig);

    msalInstance.handleRedirectCallback((error, response) => {
        // handle redirect response or error
    });

```

Para más información sobre las opciones de configuración, lea [Inicialización de aplicaciones cliente con MSAL.js](https://docs.microsoft.com/azure/active-directory/develop/msal-js-initializing-client-applications).

#### <a name="2-login-the-user"></a>2. Inicio de sesión del usuario

La aplicación debe iniciar sesión al usuario con el método `loginPopup` o `loginRedirect` para establecer el contexto de usuario.

Cuando se llama a los métodos de inicio de sesión y el servicio de Azure AD completa la autenticación del usuario, se devuelve un [token de identificador](https://docs.microsoft.com/azure/active-directory/develop/id-tokens) que se usa para identificar al usuario con cierta información básica.

Al iniciar sesión un usuario, puede pasar ámbitos a los que el usuario puede dar su consentimiento previo al inicio de sesión, pero esto no es necesario. Tenga en cuenta que dar su consentimiento a ámbitos en el inicio de sesión no devuelve un access_token para estos ámbitos, pero le ofrece la oportunidad de obtener un token de forma silenciosa con estos ámbitos pasados, sin ninguna interacción adicional del usuario.

Se recomienda solicitar solo ámbitos que necesite cuando los necesite, un concepto denominado consentimiento dinámico. Aunque esto puede crear un consentimiento más interactivo para los usuarios de la aplicación, también reduce la pérdida de usuarios que pueden sentirse incómodos concediéndole una gran lista de permisos para características que aún no están usando.

AAD solo le permitirá obtener el consentimiento de 3 recursos a la vez, aunque puede solicitar muchos ámbitos dentro de un recurso.
Cuando el usuario realiza una solicitud de inicio de sesión, puede pasar varios recursos y sus ámbitos correspondientes porque AAD emite un idToken que da su consentimiento previo a esos ámbitos. Sin embargo, las llamadas acquireToken solo son válidas para un recurso o varios ámbitos. Si necesita acceder a varios recursos, realice llamadas acquireToken independientes por recurso.

```JavaScript
   var loginRequest = {
       scopes: ["user.read", "mail.send"] // optional Array<string>
   };

    msalInstance.loginPopup(loginRequest)
        .then(response => {
            // handle response
        })
        .catch(err => {
            // handle error
        });

```

##### <a name="ssosilent"></a>ssoSilent

Si está seguro de que el usuario tiene una sesión existente y desea establecer el contexto de usuario sin solicitar la interacción, puede invocar `ssoSilent` con una `loginHint` o `sid` (disponible como [notificación opcional](https://docs.microsoft.com/azure/active-directory/develop/active-directory-optional-claims)) y MSAL intentará realizar el inicio de sesión único silenciosamente en la sesión existente y establecer el contexto de usuario.

Tenga en cuenta que, si no hay ninguna sesión activa para el objeto `loginHint` o `sid`, se producirá un error, que se debe controlar invocando un método de inicio de sesión interactivo (`loginPopup` o `loginRedirect`).

Ejemplo:

```js
const ssoRequest = {
    loginHint: "user@example.com"
};

msalInstance.ssoSilent(ssoRequest)
    .then(response => {
        // session silently established
    })
    .catch(error => {
        // handle error by invoking an interactive login method
        msalInstance.loginPopup(ssoRequest);
    });
```

#### <a name="3-get-an-access-token-to-call-an-api"></a>3. Obtención de un token de acceso para llamar a una API

En MSAL, puede obtener tokens de acceso para las API a las que la aplicación necesita llamar mediante el método `acquireTokenSilent` que realiza una solicitud silenciosa (sin preguntar al usuario con la interfaz de usuario) a Azure AD para obtener un token de acceso. A continuación, el servicio Azure AD devuelve un [token de acceso](https://docs.microsoft.com/azure/active-directory/develop/access-tokens) que contiene los ámbitos con consentimiento del usuario para permitir que la aplicación llame de forma segura a la API.

Puede usar `acquireTokenRedirect` o `acquireTokenPopup` para iniciar solicitudes interactivas, aunque es recomendable mostrar solo experiencias interactivas si no puede obtener un token de forma silenciosa debido a errores de interacción necesarios. Si usa una llamada de token interactiva, debe coincidir con el método de inicio de sesión usado en la aplicación. (`loginPopup`=> `acquireTokenPopup`, `loginRedirect` => `acquireTokenRedirect`).

Si se produce un error en la llamada `acquireTokenSilent` con un error de tipo `InteractionRequiredAuthError`, deberá iniciar una solicitud interactiva.  Esto puede ocurrir por muchos motivos, incluidos los ámbitos que se han revocado, los tokens expirados o los cambios de contraseña.

`acquireTokenSilent` buscará un token válido en la memoria caché y, si está cerca de expirar o no existe, intentará actualizarlo automáticamente.

Consulte [Tipos de datos de solicitud y respuesta](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL.js-1.0.0-api-release#signing-in-and-getting-tokens-with-msaljs) para obtener referencia.

```JavaScript
    // if the user is already logged in you can acquire a token
    if (msalInstance.getAccount()) {
        var tokenRequest = {
            scopes: ["user.read", "mail.send"]
        };
        msalInstance.acquireTokenSilent(tokenRequest)
            .then(response => {
                // get access token from response
                // response.accessToken
            })
            .catch(err => {
                // could also check if err instance of InteractionRequiredAuthError if you can import the class.
                if (err.name === "InteractionRequiredAuthError") {
                    return msalInstance.acquireTokenPopup(tokenRequest)
                        .then(response => {
                            // get access token from response
                            // response.accessToken
                        })
                        .catch(err => {
                            // handle error
                        });
                }
            });
    } else {
        // user is not logged in, you will need to log them in to acquire a token
    }
```

#### <a name="4-use-the-token-as-a-bearer-in-an-http-request-to-call-the-microsoft-graph-or-a-web-api"></a>4. Usar el token como portador en una solicitud HTTP para llamar a Microsoft Graph o una API web

```JavaScript
    var headers = new Headers();
    var bearer = "Bearer " + token;
    headers.append("Authorization", bearer);
    var options = {
         method: "GET",
         headers: headers
    };
    var graphEndpoint = "https://graph.microsoft.com/v1.0/me";

    fetch(graphEndpoint, options)
        .then(resp => {
             //do something with response
        });
```

Puede obtener más información sobre la funcionalidad MSAL.js documentada en la [Wiki de MSAL](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) y encontrar [ejemplos de código](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/Samples) completos.

## <a name="security-reporting"></a>Informes de seguridad

Si encuentra un problema de seguridad con nuestras bibliotecas o servicios, notifiquelo a [secure@microsoft.com](mailto:secure@microsoft.com) con la mayor cantidad de detalles posible. Su envío puede ser elegible para una recompensa a través del programa de [recompensas de Microsoft](http://aka.ms/bugbounty). No publique problemas de seguridad en Problemas de GitHub ni en ningún otro sitio público. Nos pondremos en contacto con usted a la mayor brevedad posible después de recibir la información. Le animamos a que obtenga notificaciones de los incidentes de seguridad que se produzcan; para ello, visite [esta página](https://technet.microsoft.com/security/dd252948) y suscríbase a las alertas de avisos de seguridad.

## <a name="license"></a>Licencia

Copyright (c) Microsoft Corporation.  Todos los derechos reservados. Con la Licencia MIT (la "Licencia");

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>Valoramos el código de conducta de código abierto de Microsoft y nos adherimos a él

El proyecto ha adoptado el [Código de conducta de código abierto de Microsoft](https://opensource.microsoft.com/codeofconduct/). Para más información, consulte las [preguntas más frecuentes del código de conducta](https://opensource.microsoft.com/codeofconduct/faq/) o póngase en contacto con [opencode@microsoft.com](mailto:opencode@microsoft.com) si tiene cualquier otra pregunta o comentario.
