---
ms.openlocfilehash: 21db9b7ec97b7028a031a18867aab00575b09850
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2022
ms.locfileid: "138053102"
---
# <a name="delayed-stream"></a>delayed-stream

Almacena en búfer los eventos de una secuencia hasta que esté listo para gestionarlos.

## <a name="installation"></a>Instalación

``` bash
npm install delayed-stream
```

## <a name="usage"></a>Uso

En el ejemplo siguiente se muestra cómo escribir un servidor de eco http que retrasa su respuesta en 1000 ms.

``` javascript
var DelayedStream = require('delayed-stream');
var http = require('http');

http.createServer(function(req, res) {
  var delayed = DelayedStream.create(req);

  setTimeout(function() {
    res.writeHead(200);
    delayed.pipe(res);
  }, 1000);
});
```

Si no usa `Stream#pipe`, también puede liberar manualmente los eventos almacenados en búfer si llama a `delayedStream.resume()`:

``` javascript
var delayed = DelayedStream.create(req);

setTimeout(function() {
  // Emit all buffered events and resume underlaying source
  delayed.resume();
}, 1000);
```

## <a name="implementation"></a>Implementación

Para usar correctamente esta metasecuencia, aquí le dejamos información que debe conocer sobre la implementación.

### <a name="event-buffering--proxying"></a>Almacenamiento en búfer/redirección mediante proxy de eventos

Todos los eventos de la secuencia `source` se secuestran sobrescribiendo el método `source.emit`. Hasta que el nodo implemente un agente de escucha de eventos que capture todo, esta es la única manera de hacerlo.

Sin embargo, delayed-stream sigue emitiendo todos los eventos que captura en `source`, independientemente de si ha liberado ya la secuencia diferida o no.

Tras la creación, delayed-stream captura todos los eventos `source` y los almacena en un búfer de eventos interno. Una vez que se llama a `delayedStream.release()`, se emiten todos los eventos almacenados en búfer en `delayedStream` y se borra el búfer de eventos. Después de eso, delayed-stream simplemente actúa como un proxy para el origen subyacente.

### <a name="error-handling"></a>Control de errores

Los eventos de error de `source` se almacenan en búfer o se redirigen mediante proxy como cualquier otro evento.
Sin embargo, `delayedStream.create` asocia un cliente de escucha `'error'` no operativo a `source`. De este modo, solo tiene que controlar los errores en el objeto `delayedStream`, y no en dos lugares.

### <a name="buffer-limits"></a>Límites del búfer

delayed-stream proporciona una propiedad `maxDataSize` que se puede usar para limitar la cantidad de datos almacenados en búfer. Para protegerle de secuencias de `source` incorrectas que no reaccionan a `source.pause()`, esta característica está habilitada de forma predeterminada.

## <a name="api"></a>API

### <a name="delayedstreamcreatesource-options"></a>DelayedStream.create(source, [options])

Devuelve un objeto `delayedStream` nuevo. Las opciones disponibles son la siguientes:

* `pauseStream`
* `maxDataSize`

A continuación encontrará la descripción de esas propiedades.

### <a name="delayedstreamsource"></a>delayedStream.source

Secuencia `source` administrada por este objeto. Esto resulta útil si pasa su `delayedStream` y desea tener acceso a las propiedades del objeto `source`.

### <a name="delayedstreampausestream--true"></a>delayedStream.pauseStream = true

Si se debe pausar el `source` subyacente al llamar a `DelayedStream.create()`. La modificación de esta propiedad más tarde no tiene ningún efecto.

### <a name="delayedstreammaxdatasize--1024--1024"></a>delayedStream.maxDataSize = 1024 * 1024

Cantidad de datos que se van a almacenar en búfer antes de emitir una `error`.

Si el origen subyacente emite objetos `Buffer`, `maxDataSize` hace referencia a bytes.

Si el origen subyacente emite cadenas de JavaScript, el tamaño hace referencia a los caracteres.

Si sabe lo que está haciendo, puede establecer esta propiedad en `Infinity` para deshabilitar esta característica. También puede modificar esta propiedad durante el tiempo de ejecución.

### <a name="delayedstreamdatasize--0"></a>delayedStream.dataSize = 0

Cantidad de datos almacenados en búfer hasta ahora.

### <a name="delayedstreamreadable"></a>delayedStream.readable

Captador ECMA5 que devuelve el valor de `source.readable`.

### <a name="delayedstreamresume"></a>delayedStream.resume()

Si no se ha publicado la `delayedStream` hasta ahora, se llama a `delayedStream.release()`.

En cualquier caso, se llama a `source.resume()`.

### <a name="delayedstreampause"></a>delayedStream.pause()

Llama a `source.pause()`.

### <a name="delayedstreampipedest"></a>delayedStream.pipe(dest)

Llama a `delayedStream.resume()` y, a continuación, redirige los argumentos mediante proxy a `source.pipe`.

### <a name="delayedstreamrelease"></a>delayedStream.release()

Emite y borra todos los eventos que se han almacenado en búfer hasta ahora. Esto no reanuda el origen subyacente, use `delayedStream.resume()` en su lugar.

## <a name="license"></a>Licencia

delayed-stream se publica en virtud de la licencia de MIT.
