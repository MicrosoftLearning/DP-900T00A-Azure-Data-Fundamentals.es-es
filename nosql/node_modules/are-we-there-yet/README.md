---
ms.openlocfilehash: 34b661fbb1237d51bdab932626d19518225841a0
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052910"
---
<a name="are-we-there-yet"></a>¿Ya lo hemos conseguido?
----------------

Realice un seguimiento de jerarquías complejas de estados de finalización de tareas asincrónicas.  El objetivo es facilitarle una manera de registrar e informar del progreso de los flujos de trabajo de distribución ramificada recursiva y recopilación de gran tamaño tan comunes en tareas asincrónicas.

Lo que haga con estos datos de finalización será decisión suya, pero el caso de uso más común es incluirlos en uno de los muchos módulos que incluye la barra de progreso.

La mayoría de los módulos de la barra de progreso incluyen una versión rudimentaria de esta función, pero mis necesidades eran más complejas.

<a name="usage"></a>Uso
=====

```javascript
var TrackerGroup = require("are-we-there-yet").TrackerGroup

var top = new TrackerGroup("program")

var single = top.newItem("one thing", 100)
single.completeWork(20)

console.log(top.completed()) // 0.2

fs.stat("file", function(er, stat) {
  if (er) throw er  
  var stream = top.newStream("file", stat.size)
  console.log(top.completed()) // now 0.1 as single is 50% of the job and is 20% complete
                              // and 50% * 20% == 10%
  fs.createReadStream("file").pipe(stream).on("data", function (chunk) {
    // do stuff with chunk
  })
  top.on("change", function (name) {
    // called each time a chunk is read from "file"
    // top.completed() will start at 0.1 and fill up to 0.6 as the file is read
  })
})
```

<a name="shared-methods"></a>Métodos compartidos
==============

* var completed = tracker.completed()

Implementado en: `Tracker`, `TrackerGroup`, `TrackerStream`

Devuelve la relación entre el trabajo completado y el trabajo que falta por hacer. Intervalo de 0 a 1.

* tracker.finish()

Implementado en: `Tracker`, `TrackerGroup`

Marca el seguimiento como completado. Con un grupo de seguimiento, se marcan todos sus componentes como completados.

Marca todos los componentes de este seguimiento como finalizados, lo que a su vez significa que `tracker.completed()` ahora será 1.

Esto provocará que se emitan uno o varios eventos `change`.

<a name="events"></a>Eventos
======

Todos los objetos de seguimiento emiten eventos `change` con los argumentos siguientes:

```
function (name, completed, tracker)
```

`name` es el nombre del seguimiento que emitió originalmente el evento, o si no tenía ninguno, el primero que contiene el grupo de seguimiento que tenga alguno.

`completed` es el porcentaje completado (tal como lo devuelve el método `tracker.completed()`).

`tracker` es el objeto de seguimiento en el que está escuchando eventos.

<a name="trackergroup"></a>TrackerGroup
============

* var tracker = new TrackerGroup(**name**)

  * **name** *(opcional):* el nombre de este grupo de seguimiento, que se usa en las notificaciones de cambio si la actualización del componente no tenía ningún nombre. El valor predeterminado es indefinido.

Crea un nuevo grupo de agregaciones de seguimiento vacío. Se trata de seguimientos cuyo estado de finalización viene determinado por el estado de finalización de otros seguimientos.

* tracker.addUnit(**otherTracker**, **weight**)

  * **otherTracker**: cualquiera de los otros objetos de seguimiento de tipo "¿Ya lo hemos conseguido?"
  * **weight** *(opcional):* el peso que se va a dar al seguimiento; el valor predeterminado es 1.

Agrega **otherTracker** a este grupo de agregaciones. El peso determina cuánto tiempo espera que este seguimiento tarde en completarse en proporción a otras unidades.  Por ejemplo, si agrega un seguimiento con un peso de 1 y otro con un peso de 2, el segundo tardará dos veces en completarse que el primero.  Por lo tanto, el primero contará el 33 % de la finalización de este seguimiento y el segundo contará el otro 67 %.

Devuelve **otherTracker**.

* var subGroup = tracker.newGroup(**name**, **weight**)

Lo anterior equivale exactamente a:

```javascript
  var subGroup = tracker.addUnit(new TrackerGroup(name), weight)
```

* var subItem = tracker.newItem(**name**, **todo**, **weight**)

Lo anterior equivale exactamente a:

```javascript
  var subItem = tracker.addUnit(new Tracker(name, todo), weight)
```

* var subStream = tracker.newStream(**name**, **todo**, **weight**)

Lo anterior equivale exactamente a:

```javascript
  var subStream = tracker.addUnit(new TrackerStream(name, todo), weight)
```

* console.log( tracker.debug() )

Devuelve un árbol que muestra la finalización de este grupo de seguimiento y todos sus elementos secundarios, incluida la entrada recursiva de todos los elementos secundarios.

<a name="tracker"></a>Tracker
=======

* var tracker = new Tracker(**name**, **todo**)

  * **name** *(opcional)* Nombre de este contador que se va a notificar en los eventos de cambio.  El valor predeterminado es indefinido.
  * **todo** *(opcional)* Cantidad de trabajo pendiente (un número). El valor predeterminado es 0.

Normalmente, se construyen como parte de un grupo de seguimiento (mediante `newItem`).

* var completed = tracker.completed()

Devuelve la relación entre el trabajo completado y el trabajo que falta por hacer. Intervalo de 0 a 1. Si el trabajo pendiente total es 0, devolverá 0.

* tracker.addWork(**todo**)

  * **todo** Número que se va a agregar a la cantidad de trabajo pendiente.

Aumenta la cantidad de trabajo pendiente, lo que reduce el porcentaje de finalización.  Desencadena un evento `change`.

* tracker.completeWork(**completed**)

  * **completed** Número que se va a agregar al trabajo completado

Aumenta la cantidad de trabajo completado, lo que aumenta el porcentaje de finalización.
Nunca aumentará el trabajo completado más allá de la cantidad de trabajo pendiente. Es decir, no se permiten porcentajes superiores al 100 %. Desencadena un evento `change`.

* tracker.finish()

Marca este seguimiento como finalizado, tracker.completed() ahora será 1. Desencadena un evento `change`.

<a name="trackerstream"></a>TrackerStream
=============

* var tracker = new TrackerStream(**name**, **size**, **options**)

  * **name** *(opcional)* Nombre de este contador que se va a notificar en los eventos de cambio.  El valor predeterminado es indefinido.
  * **size** *(opcional)* El número de bytes que se envían a través de esta secuencia.
  * **options** *(opcional)* Un hash de las opciones de secuencia.

El objeto de secuencia de seguimiento es un paso de la secuencia que actualiza un objeto de seguimiento interno cada vez que pasa un bloque.  Está pensado para realizar un seguimiento de las descargas, la extracción de archivos y otras actividades relacionadas. Para usarlo, canalícelo hasta el origen de datos y, a continuación, úselo como origen de datos.

Si los datos tienen un atributo length, se usará como la cantidad de trabajo completado cuando se pase el fragmento.  Si no es así, (por ejemplo, secuencias de objetos), cada fragmento cuenta como 1 unidad de trabajo, por lo que el tamaño debe ser el número total de objetos de la secuencia.

* tracker.addWork(**todo**)

  * **todo** Aumenta el tamaño total esperado por bytes de **tareas pendientes**.

Aumenta la cantidad de trabajo pendiente, lo que reduce el porcentaje de finalización.  Desencadena un evento `change`.
